<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="favicon">
    <title>Viewing Dispute</title>

    <link rel="stylesheet" href="src/styles.css">
    <link rel="stylesheet" href="src/app.css">
    <link rel="stylesheet" href="src/css/whitespace.css">
    <link rel="stylesheet" href="src/css/contextmenu.css">

    <script src="https://c-zero.web.app/js/brickjs.js"></script>

    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>
    <link rel="shortcut icon" type="image/jpg" href="src/dispute_favicon.svg" />

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>
</head>

<body style="height: 100%; display: block; background: var(--background-darkest); overflow: hidden;">
    <datalist id="auth_required">false</datalist>
    <datalist id="page">profile</datalist>

    <!-- Context Menu -->
    <div class="context-menu onhover shadow">
        <ul class="menu-options"></ul>
    </div>

    <div class="container2">
        <div class="grid grid-place-center" style="height: 100vh;">
            <div class="card">
                <h2 class="heading">User doesn't exist</h2>
                <button onclick="window.location = 'app'">Open Dispute</button>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="src/firebase/firebase-init.js"></script>
    <script src="src/firebase/users/auth.js"></script>
    <script src="src/firebase/firestore/data.js"></script>
    <script src="src/firebase/firestore/users.js"></script>

    <script>
        // console.log

        let console_styles = {
            base: [
                "color: #fff",
                "background-color: #444",
                "padding: 2px 4px",
                "border-radius: 2px"
            ],
            warning: [
                "color: #eee",
                "background-color: #ff4747"
            ],
            success: [
                "background-color: green"
            ]
        }
        let log = (text, extra = []) => {
            let style = console_styles.base.join(';') + ';';
            style += extra.join(';');
            console.log(`%c${text}`, style);
        }

        // Context Menu

        const menu = document.querySelector(".context-menu");
        let menuVisible = false;

        const toggleMenu = command => {
            menu.style.display = command === "show" ? "block" : "none";
            menuVisible = !menuVisible;
        };

        const setPosition = ({
            top,
            left
        }) => {
            menu.style.left = `${left}px`;
            menu.style.top = `${top}px`;
            toggleMenu("show");
        };

        window.addEventListener("mousedown", e => {
            if (menuVisible) setTimeout(() => {
                toggleMenu("hide")
            }, 50);;
        });

        window.addEventListener("contextmenu", e => {
            e.preventDefault();
            document.querySelector(".menu-options").innerHTML = ""

            document.querySelector(".menu-options").insertAdjacentHTML("beforeend", `
                <li class="menu-option onhover shadow" context-action="history-back">Back</li>
                <li class="menu-option onhover shadow" context-action="reload">Reload</li>
            `)

            const origin = {
                left: e.pageX,
                top: e.pageY
            };
            setPosition(origin);

            if (e.target.classList.contains("dm")) { // check if object right clicked is a dm ðŸ˜Ž
                for (i = 0; i < e.target.children.length; i++) {
                    if (e.target.children[i].nodeName == "DATALIST") { // get the datalist from inside the dm
                        document.querySelector(".menu-options").insertAdjacentHTML("beforeend", `
                            <li class="menu-option onhover shadow" onmousedown="delete_dm('${e.target.children[i].innerHTML}')">Delete</li>
                        `)
                    }
                }
            }

            attribute("context-action", "reload").addEventListener('mousedown', () => {
                window.location.reload()
            })

            attribute("context-action", "history-back").addEventListener('mousedown', () => {
                window.history.back()
            })

            return false;
        });
    </script>
</body>

</html>
